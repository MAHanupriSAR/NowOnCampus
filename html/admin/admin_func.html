<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - NowOnCampus</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="../../css/admin_func.css">
</head>
<body>
    <header class="header">
        <nav class="nav container">
            <div class="logo">
                <i class="fas fa-graduation-cap logo-icon"></i>
                NowOnCampus
            </div>
            <ul class="nav-menu">
                <li><a href="home.html" class="nav-link">
                    <i class="fas fa-home nav-icon"></i>
                    Home
                </a></li>
                <li><a href="events.html" class="nav-link">
                    <i class="fas fa-calendar-alt nav-icon"></i>
                    Events
                </a></li>
                <li><a href="calendar.html" class="nav-link">
                    <i class="fas fa-calendar-check nav-icon"></i>
                    My Calendar
                </a></li>
                <li><a href="admin_func.html" class="nav-link active">
                    <i class="fas fa-cog nav-icon"></i>
                    Admin
                </a></li>
                <li><a href="about.html" class="nav-link">
                    <i class="fas fa-info-circle nav-icon"></i>
                    About
                </a></li>
            </ul>
            <div class="user-section">
                <span class="welcome-text">Welcome, Admin</span>
                <a href="../home.html" class="btn btn-logout">
                    <i class="fas fa-sign-out-alt btn-icon"></i>
                    Logout
                </a>
            </div>
        </nav>
    </header>

    <main class="main">
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">Admin Dashboard</h1>
                <p class="page-subtitle">Manage events, admins, students, and monitor registrations</p>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Total Events</div>
                    </div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">214</div>
                        <div class="stat-label">Total Registrations</div>
                    </div>
                </div>
                <div class="stat-card purple">
                    <div class="stat-icon">
                        <i class="fas fa-cog"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">2</div>
                        <div class="stat-label">Active Events</div>
                    </div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Total Admins</div>
                    </div>
                </div>
                <div class="stat-card teal">
                    <div class="stat-icon">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">1</div>
                        <div class="stat-label">Total Students</div>
                    </div>
                </div>
            </div>

            <!-- Management Tabs -->
            <div class="management-tabs">
                <button class="tab-btn active" data-tab="events">
                    <i class="fas fa-calendar-alt tab-icon"></i>
                    Event Management
                </button>
                <button class="tab-btn" data-tab="admins">
                    <i class="fas fa-user-shield tab-icon"></i>
                    Admin Management
                </button>
                <button class="tab-btn" data-tab="students">
                    <i class="fas fa-user-graduate tab-icon"></i>
                    Student Management
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Event Management Tab -->
                <div class="tab-pane active" id="events-tab">
                    <div class="section-header">
                        <h2 class="section-title">Event Management</h2>
                        <button class="btn btn-create">
                            <i class="fas fa-plus btn-icon"></i>
                            Create Event
                        </button>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Event</th>
                                    <th>Date & Time</th>
                                    <th>Location</th>
                                    <th>Type</th>
                                    <th>Capacity</th>
                                    <th>Registrations</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div class="event-info">
                                            <div class="event-name">Annual Tech Symposium 2024</div>
                                            <div class="event-dept">Computer Science</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="date-time">
                                            <div>2024-06-15 - 2024-06-15</div>
                                            <div class="time">09:00 - 17:00</div>
                                        </div>
                                    </td>
                                    <td>Main Auditorium</td>
                                    <td><span class="type-badge seminar">Seminar</span></td>
                                    <td>200</td>
                                    <td>125</td>
                                    <td><span class="status-badge open">Open</span></td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn close" title="Close">
                                                <i class="fas fa-times-circle"></i>
                                            </button>
                                            <button class="action-btn delete" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div class="event-info">
                                            <div class="event-name">Spring Cultural Festival</div>
                                            <div class="event-dept">Student Affairs</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="date-time">
                                            <div>2024-06-20 - 2024-06-22</div>
                                            <div class="time">18:00 - 22:00</div>
                                        </div>
                                    </td>
                                    <td>Campus Grounds</td>
                                    <td><span class="type-badge fest">Fest</span></td>
                                    <td>500</td>
                                    <td>89</td>
                                    <td><span class="status-badge open">Open</span></td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view" title="View">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="action-btn edit" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn close" title="Close">
                                                <i class="fas fa-times-circle"></i>
                                            </button>
                                            <button class="action-btn delete" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Admin Management Tab -->
                <div class="tab-pane" id="admins-tab">
                    <div class="section-header">
                        <h2 class="section-title">Admin Management</h2>
                        <button class="btn btn-create" id="btn-create-admin">
                            <i class="fas fa-user-plus btn-icon"></i>
                            Create Admin
                        </button>
                    </div>
                    <!-- Add a hidden form for creating new admin -->
                    <form id="create-admin-form" style="display: none; margin-bottom: 1rem;">
                        <label>Name: <input type="text" id="admin-name" required></label>
                        <label>Email: <input type="email" id="admin-email" required></label>
                        <label>Password: <input type="password" id="admin-password" required></label>
                        <label>Confirm: <input type="password" id="admin-confirm" required></label>
                        <button class="btn" id="create-admin-submit" type="submit">Submit</button>
                        <button class="btn" id="create-admin-cancel" type="button">Cancel</button>
                    </form>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="admins-tbody">
                                <tr>
                                    <td>Admin User</td>
                                    <td>admin@college.edu</td>
                                    <td><span class="role-badge admin">Admin</span></td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn edit" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <form id="edit-admin-password-form" style="display:none; margin-bottom:1rem;">
                        <input type="hidden" id="edit-admin-email">
                        <label>New Password: <input type="password" id="edit-admin-password" required></label>
                        <label>Confirm Password: <input type="password" id="edit-admin-confirm" required></label>
                        <button class="btn" id="edit-admin-password-submit" type="submit">Update</button>
                        <button class="btn" id="edit-admin-password-cancel" type="button">Cancel</button>
                    </form>
                </div>

                <!-- Student Management Tab -->
                <div class="tab-pane" id="students-tab">
                    <div class="section-header">
                        <h2 class="section-title">Student Management</h2>
                    </div>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Student User</td>
                                    <td>student@college.edu</td>
                                    <td><span class="role-badge student">Student</span></td>
                                    <td>
                                        <div class="action-buttons">
                                            <button class="action-btn view" title="View">
                                                <i class="fas fa-external-link-alt"></i>
                                            </button>
                                            <button class="action-btn edit" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="action-btn delete" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tabName = btn.getAttribute('data-tab');
                
                // Remove active class from all tabs and panes
                document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding pane
                btn.classList.add('active');
                document.getElementById(`${tabName}-tab`).classList.add('active');
            });
        });

        // Show edit password form when edit button is clicked
        document.getElementById('admins-tbody').addEventListener('click', function(e) {
            if (e.target.closest('.action-btn.edit')) {
                const btn = e.target.closest('.action-btn.edit');
                const email = btn.getAttribute('data-email');
                document.getElementById('edit-admin-email').value = email;
                document.getElementById('edit-admin-password-form').style.display = 'block';
            }
        });

        // Cancel button for edit password form
        document.getElementById('edit-admin-password-cancel').addEventListener('click', () => {
            const form = document.getElementById('edit-admin-password-form');
            form.style.display = 'none';
            form.reset();
        });

        // Handle edit password form submission
        document.getElementById('edit-admin-password-submit').addEventListener('click', async (e) => {
            e.preventDefault();
            const email = document.getElementById('edit-admin-email').value;
            const password = document.getElementById('edit-admin-password').value;
            const confirm = document.getElementById('edit-admin-confirm').value;

            if (password !== confirm) {
                alert('Passwords do not match.');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/updateAdminPassword', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                if (response.ok) {
                    alert(data.message);
                    const form = document.getElementById('edit-admin-password-form');
                    form.style.display = 'none';
                    form.reset();
                } else {
                    alert(data.error || 'Error updating password');
                }
            } catch (err) {
                alert('Server error');
            }
        });

        // Handle delete button click for admins
        document.getElementById('admins-tbody').addEventListener('click', async function(e) {
            if (e.target.closest('.action-btn.delete')) {
                const btn = e.target.closest('.action-btn.delete');
                const email = btn.getAttribute('data-email');
                if (confirm('Are you sure you want to delete this admin?')) {
                    try {
                        const response = await fetch('http://localhost:3000/deleteAdmin', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email })
                        });
                        const data = await response.json();
                        if (response.ok) {
                            alert(data.message);
                            loadAdmins();
                        } else {
                            alert(data.error || 'Error deleting admin');
                        }
                    } catch (err) {
                        alert('Server error');
                    }
                }
            }
        });

        //cancel admin creation
        document.getElementById('create-admin-cancel').addEventListener('click', () => {
            const form = document.getElementById('create-admin-form');
            form.style.display = 'none';
            form.reset();
        }); 
        // Toggle Create Admin form
        document.getElementById('btn-create-admin').addEventListener('click', () => {
            const form = document.getElementById('create-admin-form');
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });

        // Handle form submission
        document.getElementById('create-admin-submit').addEventListener('click', async (e) => {
            e.preventDefault();
            const name = document.getElementById('admin-name').value.trim();
            const email = document.getElementById('admin-email').value.trim();
            const password = document.getElementById('admin-password').value;
            const confirm = document.getElementById('admin-confirm').value;

            if (password !== confirm) {
                alert('Passwords do not match.');
                return;
            }

            try {
                const response = await fetch('http://localhost:3000/createAdmin', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                const data = await response.json();
                if (response.ok) {
                    alert(data.message);
                    // Reload or fetch updated list
                    const form = document.getElementById('create-admin-form');
                    form.style.display = 'none';
                    form.reset();
                    loadAdmins();
                } else {
                    alert(data.error || 'Error creating admin');
                }
            } catch (err) {
                alert('Server error');
            }
        });

        // Function to render admins
        async function loadAdmins() {
            const tbody = document.getElementById('admins-tbody');
            tbody.innerHTML = '<tr><td colspan="4">Loading...</td></tr>';
            try {
                const res = await fetch('http://localhost:3000/admins');
                const admins = await res.json();
                if (admins.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4">No admins found.</td></tr>';
                    return;
                }
                tbody.innerHTML = admins.map(admin => `
                    <tr>
                        <td>${admin.name}</td>
                        <td>${admin.email}</td>
                        <td><span class="role-badge admin">Admin</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit" title="Edit" data-email="${admin.email}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete" title="Delete" data-email="${admin.email}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                tbody.innerHTML = '<tr><td colspan="4">Failed to load admins.</td></tr>';
            }
        }
        // Call loadAdmins on page load and after creating an admin
        document.addEventListener('DOMContentLoaded', loadAdmins);
    </script>
</body>
</html>